<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TS ANGEL AI BOT</title>
  <style>
    body { font-family: monospace; background: #0a0f2c; color: #00f3ff; }
    .container { display: flex; padding: 20px; gap: 30px; }
    select, button { width: 100%; padding: 10px; margin: 5px 0; background: #000; color: #00ffcc; border: 1px solid #00f3ff; }
    .chart-box, .form-box { flex: 1; }
    .signal-output, .log-box { padding: 10px; border: 1px solid #00f3ff; margin-top: 10px; color: #00ffcc; }
    .green { color: #00ff00; } .red { color: #ff4444; }
  </style>
</head>
<body>
  <h2 style="text-align: center;">üöÄ TS ANGEL AI BOT</h2>
  <div class="container">
    <div class="form-box">
      <label>Broker</label>
      <select id="broker"><option>QUOTEX</option></select>

      <label>Pair</label>
      <select id="pair">
        <option value="EURUSD">EUR/USD</option>
        <option value="AUDUSD">AUD/USD</option>
        <option value="GBPUSD">GBP/USD</option>
      </select>

      <label>Timeframe</label>
      <select id="timeframe">
        <option value="1">M1</option>
        <option value="5">M5</option>
      </select>

      <button onclick="generateSignal()">üéØ Generate Signal Now</button>

      <div id="clock">‚è∞ Indian Time: --:--:--</div>
      <div id="signal" class="signal-output">üì¢ Signal will appear here...</div>
    </div>

    <div class="chart-box">
      <iframe id="tv_chart" style="width: 100%; height: 400px;" src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_0b063&symbol=FX:AUDUSD&interval=1&hidesidetoolbar=1&symboledit=1&hideideas=1&theme=dark" frameborder="0"></iframe>
      <div id="log" class="log-box">üóíÔ∏è Signal Logs will appear here...</div>
    </div>
  </div>

  <script>
    let lastPrice = null;

    function updateClock() {
      const now = new Date();
      const ist = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Kolkata" }));
      document.getElementById("clock").innerText = "‚è∞ Indian Time: " + ist.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);

    function generateSignal() {
      const pair = document.getElementById("pair").value;
      const tf = document.getElementById("timeframe").value;

      const priceEl = document.querySelector('iframe').contentWindow.document.querySelector(".tv-symbol-price-quote__value");
      
      if (!priceEl) {
        document.getElementById("signal").innerText = "‚ö†Ô∏è Unable to fetch price. Please wait for chart to load.";
        return;
      }

      const currentPrice = parseFloat(priceEl.innerText);
      let signal = "WAIT";

      if (lastPrice) {
        if (currentPrice > lastPrice) signal = "BUY üîº";
        else if (currentPrice < lastPrice) signal = "SELL üîΩ";
        else signal = "NO CHANGE";
      } else {
        signal = "WAITING FOR NEXT PRICE...";
      }

      document.getElementById("signal").innerHTML = `PAIR: ${pair}, TF: M${tf}, SIGNAL: <span class="${signal.includes('BUY') ? 'green' : 'red'}">${signal}</span>`;
      document.getElementById("log").innerText = `Logged at ${new Date().toLocaleTimeString()} ‚Äî Last: ${lastPrice}, Now: ${currentPrice}`;

      lastPrice = currentPrice;
    }

    // Auto update price using MutationObserver
    const iframe = document.getElementById("tv_chart");
    iframe.onload = () => {
      const check = setInterval(() => {
        try {
          const priceEl = iframe.contentWindow.document.querySelector(".tv-symbol-price-quote__value");
          if (priceEl) {
            const observer = new MutationObserver(() => {
              const price = parseFloat(priceEl.innerText);
              lastPrice = price;
            });
            observer.observe(priceEl, { childList: true, characterData: true, subtree: true });
            clearInterval(check);
          }
        } catch (e) { }
      }, 1000);
    };
  </script>
</body>
</html>
